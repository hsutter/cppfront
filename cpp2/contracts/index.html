
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../functions/">
      
      
        <link rel="next" href="../types/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.22">
    
    
      
        <title>Contracts - Cpp2 and cppfront — An experimental 'C++ syntax 2' and its first compiler</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.84d31ad4.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#contracts" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Cpp2 and cppfront — An experimental &#39;C++ syntax 2&#39; and its first compiler" class="md-header__button md-logo" aria-label="Cpp2 and cppfront — An experimental 'C++ syntax 2' and its first compiler" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Cpp2 and cppfront — An experimental 'C++ syntax 2' and its first compiler
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Contracts
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Cpp2 and cppfront — An experimental &#39;C++ syntax 2&#39; and its first compiler" class="md-nav__button md-logo" aria-label="Cpp2 and cppfront — An experimental 'C++ syntax 2' and its first compiler" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Cpp2 and cppfront — An experimental 'C++ syntax 2' and its first compiler
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Welcome & getting started
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            Welcome & getting started
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../welcome/overview/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview: What are Cpp2 and cppfront? How do I get and build cppfront?
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../welcome/hello-world/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Hello, world!
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../welcome/integration/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Adding cppfront to your existing C++ project
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Cpp2 reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Cpp2 reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../common/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Common concepts
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../expressions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Expressions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../declarations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Declarations and aliases
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../objects/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Objects, initialization, and memory
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../functions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Functions, branches, and loops
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Contracts
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Contracts
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#contract-groups" class="md-nav__link">
    <span class="md-ellipsis">
      Contract groups
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#contract-predicates" class="md-nav__link">
    <span class="md-ellipsis">
      Contract predicates
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cpp2contract_group-and-customizable-violation-handling" class="md-nav__link">
    <span class="md-ellipsis">
      cpp2::contract_group, and customizable violation handling
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../types/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Types and inheritance
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../metafunctions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Metafunctions and reflection
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../namespaces/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Namespaces
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../safety/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Safety and "unchecked"
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Cppfront reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Cppfront reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cppfront/mixed/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Using Cpp1 (today's syntax) and Cpp2 in the same source file
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../cppfront/options/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cppfront command line options
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Notes and supplemental topics
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Notes and supplemental topics
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../notes/regex_status/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    @regex status: Regular expression features
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#contract-groups" class="md-nav__link">
    <span class="md-ellipsis">
      Contract groups
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#contract-predicates" class="md-nav__link">
    <span class="md-ellipsis">
      Contract predicates
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cpp2contract_group-and-customizable-violation-handling" class="md-nav__link">
    <span class="md-ellipsis">
      cpp2::contract_group, and customizable violation handling
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="contracts">Contracts</h1>
<h2 id="overview">Overview</h2>
<p>Cpp2 currently supports three kinds of contracts:</p>
<ul>
<li>
<p><strong>Preconditions and postconditions.</strong> A function declaration can include <code>pre(condition)</code> and <code>post(condition)</code> before the <code>= /* function body */</code>. Before entering the function body, preconditions are fully evaluated and postconditions are captured as function expressions to be evaluated later (and perform their captures of values on entry, if any). Immediately before exiting the function body via a normal return, postconditions are evaluated. If the function exits via an exception, postconditions are not evaluated.</p>
</li>
<li>
<p><strong>Assertions.</strong> A function body can write <code>assert(condition)</code> assertion statements. Assertions are evaluated when control flow passes through them.</p>
</li>
</ul>
<p>Notes:</p>
<ul>
<li>
<p><code>condition</code> is an expression that evaluates to <code class="highlight"><span class="nb">true</span></code> or <code class="highlight"><span class="nb">false</span></code>. It will not be evaluated unless checking for this contract group is enabled (<code>group.is_active()</code> is <code>true</code>).</p>
</li>
<li>
<p>Optionally, <code>condition</code> may be followed by <code>, "message"</code>, a message to include if a violation occurs. For example, <code>pre(condition, "message")</code>.</p>
</li>
<li>
<p>Optionally, a <code>&lt;group, pred1, pred2&gt;</code> can be written inside <code>&lt;</code> <code>&gt;</code> angle brackets immediately before the <code>(</code>, to designate that this test is part of the <a href="#groups">contract group</a> named <code>group</code> and (also optionally) <a href="#predicates">contract predicates</a> <code>pred1</code> and <code>pred2</code>. If a violation occurs, <code>Group.report_violation()</code> will be called. For example, <code>pre&lt;group&gt;(condition)</code>. If no contract group is specified, the contract defaults to being part of the <code>default</code> group (spelled <code>cpp2_default</code> when used from Cpp1 code).</p>
</li>
</ul>
<p>The order of evaluation is:</p>
<ul>
<li>
<p>First, if the contract group is <code>unevaluated</code> then the contract is ignored; <code>condition</code> is never evaluated. This special group designates conditions intended for use by static analyzers only, and the only requirement is that the condition be grammatically valid.</p>
</li>
<li>
<p>Next, predicates are evaluated in order. If any predicate evaluates to <code class="highlight"><span class="nb">false</span></code>, stop.</p>
</li>
<li>
<p>Next, <code>group.is_active()</code> is evaluated. If that evaluates to <code class="highlight"><span class="nb">false</span></code>, stop.</p>
</li>
<li>
<p>Next, <code>condition</code> is evaluated. If that evaluates to <code class="highlight"><span class="nb">true</span></code>, stop.</p>
</li>
<li>
<p>Finally, if all the predicates were true and the group is active and the condition was false, <code>group.report_violation()</code> is called.</p>
</li>
</ul>
<p>For example:</p>
<div class="highlight"><span class="filename">Precondition and postcondition examples</span><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nl">insert_at</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="n">container</span><span class="p">,</span><span class="w"> </span><span class="n">where</span><span class="o">:</span><span class="w"> </span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="n">val</span><span class="o">:</span><span class="w"> </span><span class="kt">int</span><span class="p">)</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="hll"><span class="w">    </span><span class="n">pre</span><span class="o">&lt;</span><span class="n">bounds_safety</span><span class="o">&gt;</span><span class="p">(</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">where</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">container</span><span class="p">.</span><span class="n">ssize</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;position (where)$ is outside &#39;container&#39;&quot;</span><span class="w"> </span><span class="p">)</span>
</span><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="hll"><span class="w">    </span><span class="n">post</span><span class="w">              </span><span class="p">(</span><span class="w"> </span><span class="n">container</span><span class="p">.</span><span class="n">ssize</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">container</span><span class="p">.</span><span class="n">ssize</span><span class="p">()</span><span class="n">$</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">)</span>
</span><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="w">    </span><span class="n">_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">container</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="w"> </span><span class="n">container</span><span class="p">.</span><span class="n">begin</span><span class="p">()</span><span class="o">+</span><span class="n">where</span><span class="p">,</span><span class="w"> </span><span class="n">val</span><span class="w"> </span><span class="p">);</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="p">}</span>
</code></pre></div>
<p>In this example:</p>
<ul>
<li>
<p>The <code>$</code> captures are performed before entering the function.</p>
</li>
<li>
<p>The precondition is part of the <code>bounds_safety</code> contract group and is checked before entering the function. If the check fails, say because <code>where</code> is <code class="highlight"><span class="mi">-1</span></code>, then <code class="highlight"><span class="n">cpp2</span><span class="o">::</span><span class="n">bounds_safety</span><span class="p">.</span><span class="n">report_violation</span><span class="p">(</span><span class="s">&quot;position -1 is outside &#39;container&#39;&quot;</span><span class="p">)</span></code> is called.</p>
</li>
<li>
<p>The postcondition is part of the <code>default</code> safety contract group.  If the check fails, then <code class="highlight"><span class="n">cpp2</span><span class="o">::</span><span class="k">default</span><span class="p">.</span><span class="n">report_violation</span><span class="p">()</span></code> is called.</p>
</li>
</ul>
<h2 id="contract-groups"><a id="groups"></a> Contract groups</h2>
<p>Contract groups are useful to enable or disable or <a href="#violation-handlers">set custom handlers</a> independently for different groups of contracts. A contract group <code>grp</code> is just the name of an object that can be called with:</p>
<ul>
<li>
<p><code>grp.report_violation()</code> and <code>grp.report_violation(message)</code>, where <code>message</code> is a <code>* const char</code> C-style text string</p>
</li>
<li>
<p><code>grp.is_active()</code>, which returns <code class="highlight"><span class="nb">true</span></code> if and only if the group is enabled</p>
</li>
</ul>
<p>You can create new contract groups just by creating new objects that have a <code>.report_violation</code> function. The object's name is the contract group's name. The object can be at any scope: local, global, or heap.</p>
<p>For example, here are some ways to use contract groups of type <a href="#violation-handlers"><code>cpp2::contract_group</code></a>, which is a convenient group type:</p>
<div class="highlight"><span class="filename">Using contract groups</span><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="hll"><span class="nl">group_a</span><span class="p">:</span><span class="w"> </span><span class="n">cpp2</span><span class="o">::</span><span class="n">contract_group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">();</span><span class="w">          </span><span class="c1">// a global group</span>
</span><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="nl">func</span><span class="p">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="hll"><span class="w">    </span><span class="nl">group_b</span><span class="p">:</span><span class="w"> </span><span class="n">cpp2</span><span class="o">::</span><span class="n">contract_group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">();</span><span class="w">      </span><span class="c1">// a local group</span>
</span><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="hll"><span class="w">    </span><span class="nl">group_c</span><span class="w"> </span><span class="p">:</span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="o">&lt;</span><span class="n">cpp2</span><span class="o">::</span><span class="n">contract_group</span><span class="o">&gt;</span><span class="p">();</span><span class="w">  </span><span class="c1">// a dynamically allocated group</span>
</span><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="w">    </span><span class="c1">// ...</span>
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>
<a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="hll"><span class="w">    </span><span class="n">assert</span><span class="o">&lt;</span><span class="n">group_a</span><span class="w"> </span><span class="o">&gt;</span><span class="p">(</span><span class="w"> </span><span class="n">some</span><span class="w">    </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">condition</span><span class="w"> </span><span class="p">);</span>
</span><a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="hll"><span class="w">    </span><span class="n">assert</span><span class="o">&lt;</span><span class="n">group_g</span><span class="w"> </span><span class="o">&gt;</span><span class="p">(</span><span class="w"> </span><span class="n">another</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">condition</span><span class="w"> </span><span class="p">);</span>
</span><a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a><span class="hll"><span class="w">    </span><span class="n">assert</span><span class="o">&lt;</span><span class="n">group_c</span><span class="o">*&gt;</span><span class="p">(</span><span class="w"> </span><span class="n">another</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">condition</span><span class="w"> </span><span class="p">);</span>
</span><a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a><span class="p">}</span>
</code></pre></div>
<p>You can make all the objects in a class hierarchy into a contract group by having a <code>.report_violation</code> function in a base class, and then writing contracts in that hierarchy using <code>&lt;this&gt;</code> as desired. This technique is used in cppfront's own reflection API:</p>
<div class="highlight"><span class="filename">Example of using 'this' as a contract group, from cppfront 'reflect.h2'</span><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="nl">function_declaration</span><span class="p">:</span><span class="w"> </span><span class="err">@</span><span class="n">copyable</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="o">=</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="p">{</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="w">    </span><span class="c1">// inherits from a base class that provides &#39;.report_violation&#39;</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="w">    </span><span class="c1">// ...</span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="w">    </span><span class="nl">add_initializer</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="n">inout</span><span class="w"> </span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">source</span><span class="o">:</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string_view</span><span class="p">)</span>
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="hll"><span class="w">        </span><span class="n">pre</span><span class="o">&lt;</span><span class="k">this</span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">has_initializer</span><span class="p">(),</span><span class="w"> </span><span class="s">&quot;cannot add an initializer to a function that already has one&quot;</span><span class="p">)</span>
</span><a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="hll"><span class="w">        </span><span class="n">pre</span><span class="o">&lt;</span><span class="k">this</span><span class="o">&gt;</span><span class="w"> </span><span class="p">(</span><span class="n">parent_is_type</span><span class="p">(),</span><span class="w">   </span><span class="s">&quot;cannot add an initializer to a function that isn&#39;t in a type scope&quot;</span><span class="p">)</span>
</span><a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="w">    </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/*...*/</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a>
<a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a><span class="w">    </span><span class="c1">// ...</span>
<a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a>
<a id="__codelineno-2-14" name="__codelineno-2-14" href="#__codelineno-2-14"></a><span class="p">}</span>
</code></pre></div>
<h2 id="contract-predicates"><a id="predicates"></a> Contract predicates</h2>
<p>Contract predicates are useful to conditionally check specific contracts as a static or dynamic property. Importantly, if any predicate is <code class="highlight"><span class="nb">false</span></code>, the check's conditional expression will not be evaluated.</p>
<p>For example:</p>
<div class="highlight"><span class="filename">Using contract predicates</span><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="hll"><span class="nl">is_checked_build</span><span class="p">:</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">SEE_BUILD_FLAG</span><span class="p">;</span><span class="w">   </span><span class="c1">// a static (compile-time) predicate</span>
</span><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="hll"><span class="nl">checking_enabled</span><span class="p">:</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="o">=</span><span class="w">  </span><span class="cm">/*...*/</span><span class="w"> </span><span class="p">;</span><span class="w">         </span><span class="c1">// a dynamic (run-time) predicate,</span>
</span><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="hll"><span class="w">                                            </span><span class="c1">// could change as the program runs</span>
</span><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="nl">func</span><span class="p">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="hll"><span class="w">    </span><span class="n">assert</span><span class="o">&lt;</span><span class="n">audit</span><span class="p">,</span><span class="w"> </span><span class="n">is_checked_build</span><span class="p">,</span><span class="w"> </span><span class="n">checking_enabled</span><span class="o">&gt;</span><span class="p">(</span><span class="w"> </span><span class="n">condition</span><span class="w"> </span><span class="p">);</span>
</span><a id="__codelineno-3-8" name="__codelineno-3-8" href="#__codelineno-3-8"></a><span class="p">}</span>
</code></pre></div>
<p>In this example, the order of evaluation is:</p>
<ul>
<li>
<p><code>is_checked_build</code> is evaluated. Since it is a compile-time value, the evaluation can happen at compile time. If it evaluates to <code class="highlight"><span class="nb">false</span></code>, then stop; the entire contract could be optimized away by the compiler.</p>
</li>
<li>
<p>Otherwise, next <code>checking_enabled</code> is evaluated at run time. If it evaluates to <code class="highlight"><span class="nb">false</span></code>, then stop.</p>
</li>
<li>
<p>Otherwise, next <code>audit.is_active()</code> is evaluated. If it evaluates to <code class="highlight"><span class="nb">false</span></code>, then stop.</p>
</li>
<li>
<p>Otherwise, next <code>condition</code> is evaluated. If it evaluates to <code class="highlight"><span class="nb">true</span></code>, then stop.</p>
</li>
<li>
<p>Otherwise, <code>audit.report_violation()</code> is called.</p>
</li>
</ul>
<h2 id="cpp2contract_group-and-customizable-violation-handling"><a id="violation-handlers"></a> <code>cpp2::contract_group</code>, and customizable violation handling</h2>
<p>The contract group object could also provide additional functionality. For example, Cpp2 comes with the <code>cpp2::contract_group</code> type which allows installing a customizable handler for each object. Each object can only have one handler at a time, but the handler can change during the course of the program. <code>contract_group</code> supports:</p>
<ul>
<li>
<p><code>.set_handler(pfunc)</code> accepts a pointer to a handler function with signature <code class="highlight"><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="p">)</span></code>.</p>
</li>
<li>
<p><code>.get_handler()</code> returns the current handler function pointer, or null if none is installed.</p>
</li>
<li>
<p><code>.is_active()</code> returns whether there is a current handler installed.</p>
</li>
<li>
<p><code>.enforce(condition, message)</code> evaluates <code>condition</code>, and if it is <code>false</code> then calls <code>.report_violation(message)</code>.</p>
</li>
</ul>
<p>Cpp2 comes with five predefined <code>contract group</code> global objects in namespace <code>cpp2</code>:</p>
<ul>
<li>
<p><code>default</code>, which is used as the default contract group for contracts that don't specify a group.</p>
</li>
<li>
<p><code>type_safety</code> for type safety checks.</p>
</li>
<li>
<p><code>bounds_safety</code> for bounds safety checks.</p>
</li>
<li>
<p><code>null_safety</code> for null safety checks.</p>
</li>
<li>
<p><code>testing</code> for general test checks.</p>
</li>
</ul>
<p>For these groups, the default handler is <code>cpp2::report_and_terminate</code>, which prints information about the violation to <code>std::cerr</code> and then calls <code>std::terminate()</code>. But you can customize it to do anything you want, including to integrate with any third-party or in-house error reporting system your project is already using. For example:</p>
<div class="highlight"><span class="filename">Example of customized contract violation handler</span><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="nl">main</span><span class="p">:</span><span class="w"> </span><span class="p">()</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="hll"><span class="w">    </span><span class="n">cpp2</span><span class="o">::</span><span class="k">default</span><span class="p">.</span><span class="n">set_handler</span><span class="p">(</span><span class="n">call_my_framework</span><span class="o">&amp;</span><span class="p">);</span>
</span><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="w">    </span><span class="n">assert</span><span class="o">&lt;</span><span class="k">default</span><span class="o">&gt;</span><span class="p">(</span><span class="nb">false</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;this is a test, this is only a test&quot;</span><span class="p">);</span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;done</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="p">}</span>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>
<a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="nl">call_my_framework</span><span class="p">:</span><span class="w"> </span><span class="p">(</span><span class="n">msg</span><span class="o">:</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="hll"><span class="w">    </span><span class="c1">//  You can do anything you like here, including arbitrary work</span>
</span><a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="hll"><span class="w">    </span><span class="c1">//  and integration with your current error reporting libraries,</span>
</span><a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a><span class="hll"><span class="w">    </span><span class="c1">//  log-and-continue, throw an exception, whatever is wanted...</span>
</span><a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span>
<a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a><span class="w">        </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;sending error to my framework... [&quot;</span>
<a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a><span class="w">        </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">msg</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;]</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
<a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a><span class="w">    </span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a><span class="p">}</span>
<a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a><span class="c1">//  Prints:</span>
<a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a><span class="hll"><span class="c1">//      sending error to my framework... [this is a test, this is only a test]</span>
</span></code></pre></div>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      &copy <a href="https://github.com/hsutter" target="_blank" rel="noopener">Herb Sutter</a> &bull; <a href="https://github.com/hsutter/cppfront/blob/main/LICENSE">cppfront license </a>

    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.sections", "navigation.expand", "navigation.instant", "navigation.instant.preview", "navigation.top", "search.suggest", "search.highlight", "content.tabs.link", "content.code.annotate", "content.code.annotation", "content.code.copy", "content.footnote.tooltips"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>